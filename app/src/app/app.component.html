<div class="container">
  <h1>Energy Optimizer v1</h1>
  <form (ngSubmit)="onSubmit()">
    <label>
      <a
        href="https://www.pge.com/assets/pge/docs/account/rate-plans/residential-electric-rate-plan-pricing.pdf"
        target="_blank"
        >Peak price (USD/kWh)</a
      >:
      <input
        type="number"
        step="0.01"
        [(ngModel)]="peakPrice"
        (ngModelChange)="updateUrlState()"
        name="peak_price"
      />
    </label>
    <label>
      <a
        href="https://www.pge.com/assets/pge/docs/account/rate-plans/residential-electric-rate-plan-pricing.pdf"
        target="_blank"
      >
        Off-peak price (USD/kWh)</a
      >:
      <input
        type="number"
        step="0.01"
        [(ngModel)]="offPeakPrice"
        (ngModelChange)="updateUrlState()"
        name="off_peak_price"
      />
    </label>
    <label>
      <a
        href="https://www.lazard.com/research-insights/levelized-cost-of-energyplus-lcoeplus/"
        target="_blank"
        >Battery cost per kW (USD/kWh)</a
      >:
      <input
        type="number"
        step="0.01"
        [(ngModel)]="batteryCostPerKw"
        (ngModelChange)="updateUrlState()"
        name="battery_cost_per_kw"
      />
    </label>
    <label>
      <a
        href="https://www.constellation.com/energy-101/energy-education/average-home-power-usage.html#how-many-kwh-house-use"
        target="_blank"
        >Peak consumption (kWh)</a
      >:
      <input
        type="number"
        step="1"
        [(ngModel)]="peakConsumption"
        (ngModelChange)="updateUrlState()"
        name="peak_consumption"
      />
    </label>
    <label>
      <a
        href="https://www.constellation.com/energy-101/energy-education/average-home-power-usage.html#how-many-kwh-house-use"
        target="_blank"
        >Off-peak consumption (kWh)</a
      >:
      <input
        type="number"
        step="1"
        [(ngModel)]="offPeakConsumption"
        (ngModelChange)="updateUrlState()"
        name="off_peak_consumption"
      />
    </label>

    <div>
      <label
        ><a
          href="https://www.integratesun.com/post/how-much-does-it-cost-to-install-solar-panels-in-2025-1"
          target="_blank"
          >Solar Installation Sizes:</a
        ></label
      >
      <div
        style="display: flex; gap: 8px; font-weight: bold; margin-bottom: 4px"
      >
        <span style="width: 80px">kW</span>
        <span style="width: 100px">Cost </span>
        <span style="width: 60px"></span>
      </div>
      <div
        *ngFor="let size of solarSizes; let i = index"
        style="display: flex; gap: 8px; align-items: center; margin-bottom: 4px"
      >
        <input
          type="number"
          [(ngModel)]="size.kw"
          min="0"
          step="0.1"
          placeholder="kW"
          style="width: 80px"
          name="solar_kw_{{ i }}"
        />
        <input
          type="number"
          [(ngModel)]="size.cost"
          min="0"
          step="0.01"
          placeholder="Cost"
          style="width: 100px"
          name="solar_cost_{{ i }}"
        />
        <button
          type="button"
          (click)="removeSolarSize(i)"
          *ngIf="solarSizes.length > 1"
        >
          Remove
        </button>
      </div>
      <button type="button" (click)="addSolarSize()">Add Size</button>
    </div>

    <button type="submit" [disabled]="isRunning">
      {{ isRunning ? "Running..." : "Run optimization" }}
    </button>
  </form>

  <h2>Results</h2>
  <div *ngIf="result" class="results-grid">
    <div class="result-card">
      <div class="result-label">Solar Capacity</div>
      <div class="result-value">{{ result.solar_capacity.toFixed(2) }} kW</div>
    </div>
    <div class="result-card">
      <div class="result-label">Battery Capacity</div>
      <div class="result-value">
        {{ result.battery_capacity.toFixed(2) }} kWh
      </div>
    </div>
    <div class="result-card">
      <div class="result-label">Off-peak Grid Usage</div>
      <div class="result-value">
        {{ result.off_peak_grid_usage.toFixed(2) }} kWh
      </div>
    </div>
    <div class="result-card">
      <div class="result-label">Peak Grid Consumption</div>
      <div class="result-value">
        {{ result.peak_grid_consumption.toFixed(2) }} kWh
      </div>
    </div>
  </div>
  <div *ngIf="resultError" class="error-message">
    {{ resultError }}
  </div>
  <div *ngIf="!result && !resultError" class="no-results">
    No results yet. Run the optimization to see results.
  </div>
</div>
